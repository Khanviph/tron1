(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5489:(e,r,t)=>{Promise.resolve().then(t.bind(t,4880))},4880:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var s=t(5155),a=t(2115);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)((e,r)=>{let{color:t="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:d="",children:c,iconNode:x,...h}=e;return(0,a.createElement)("svg",{ref:r,...o,width:s,height:s,stroke:t,strokeWidth:i?24*Number(n)/Number(s):n,className:l("lucide",d),...h},[...x.map(e=>{let[r,t]=e;return(0,a.createElement)(r,t)}),...Array.isArray(c)?c:[c]])}),d=(e,r)=>{let t=(0,a.forwardRef)((t,s)=>{let{className:o,...d}=t;return(0,a.createElement)(i,{ref:s,iconNode:r,className:l("lucide-".concat(n(e)),o),...d})});return t.displayName="".concat(e),t},c=d("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),x=d("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),h=d("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),u=d("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),m=d("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),g=()=>{let[e,r]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1),[l,o]=(0,a.useState)(""),[i,d]=(0,a.useState)(""),[g,p]=(0,a.useState)(""),[b,f]=(0,a.useState)([""]),[y,w]=(0,a.useState)(1);(0,a.useEffect)(()=>{let e=async()=>{try{let e=window.tronWeb;console.log("当前节点:",e.fullNode.host),r(e);try{let r=await e.trx.getNodeInfo();console.log("节点信息:",r)}catch(e){console.warn("获取节点信息失败:",e)}}catch(e){console.error("连接错误:",e),o("网络连接失败，请检查网络设置")}};(async()=>{let r=0,t=()=>{window.tronWeb&&window.tronWeb.ready&&window.tronWeb.defaultAddress&&window.tronWeb.defaultAddress.base58?e():r<10?(r++,setTimeout(t,1e3)):o("未检测到TronLink或账户未解锁，请确保在TronLink中打开并解锁钱包")};t()})()},[]);let j=e=>{let r=b.filter((r,t)=>t!==e);f(r),y>r.length&&w(r.length)},v=(e,r)=>{let t=[...b];t[e]=r,f(t)},N=async()=>{try{if(n(!0),o(""),d(""),!window.tronWeb||!window.tronWeb.ready||!window.tronWeb.defaultAddress.base58)throw Error("请确保TronLink已连接并解锁账户");let e=window.tronWeb;if(!g||!e.isAddress(g))throw Error("被控制地址格式不正确");let r=b.filter(r=>r&&e.isAddress(r));if(0===r.length)throw Error("请至少添加一个有效的控制地址");if(r.length<y)throw Error("有效控制地址数量少于所需签名数");let t={owner_address:e.address.toHex(g),owner:{type:0,permission_name:"owner",threshold:y,keys:r.map(r=>({address:e.address.toHex(r),weight:1}))},actives:[{type:2,permission_name:"active",threshold:y,operations:"7fff1fc0033e0300000000000000000000000000000000000000000000000000",keys:r.map(r=>({address:e.address.toHex(r),weight:1}))}]};console.log("更新参数:",t);let s=await e.fullNode.request("/wallet/accountpermissionupdate",t,"post");if(!s||!s.txID)throw Error("创建交易失败");console.log("交易创建成功:",s);let a=Date.now();s.expiration=a+6e4,s.timestamp=a;let l=await e.trx.sign(s);console.log("交易已签名:",l);let i=await e.trx.sendRawTransaction(l);if(console.log("交易广播结果:",i),i.result){d("多签权限设置成功! 交易ID: ".concat(s.txID));return}throw Error("交易被拒绝")}catch(e){console.error("设置多签权限错误:",e),o(e.message||"设置失败，请重试")}finally{n(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-8 px-4",children:(0,s.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-8",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(c,{className:"w-12 h-12 text-white"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white",children:"TRON多签权限设置"}),(0,s.jsx)("p",{className:"text-blue-100 mt-1",children:"安全可靠的多重签名管理工具"})]})]})}),(0,s.jsxs)("div",{className:"p-6",children:[l&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:[(0,s.jsx)(x,{className:"w-5 h-5 flex-shrink-0"}),(0,s.jsx)("p",{children:l})]}),i&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6",children:[(0,s.jsx)(h,{className:"w-5 h-5 flex-shrink-0"}),(0,s.jsx)("p",{children:i})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"被控制地址"}),(0,s.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"输入需要设置多签的地址",className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"控制地址列表"}),(0,s.jsxs)("div",{className:"space-y-3",children:[b.map((e,r)=>(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:e,onChange:e=>v(r,e.target.value),placeholder:"控制地址 ".concat(r+1),className:"flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"}),b.length>1&&(0,s.jsx)("button",{onClick:()=>j(r),className:"px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition duration-200",children:(0,s.jsx)(u,{className:"w-5 h-5"})})]},r)),b.length<5&&(0,s.jsxs)("button",{onClick:()=>{b.length<5&&f([...b,""])},className:"flex items-center space-x-2 text-blue-600 hover:text-blue-700 transition duration-200",children:[(0,s.jsx)(m,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"添加地址"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"所需签名数"}),(0,s.jsx)("input",{type:"number",value:y,onChange:e=>w(Math.min(parseInt(e.target.value)||1,b.length)),min:1,max:b.length,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"})]}),(0,s.jsx)("button",{onClick:N,disabled:t,className:"w-full px-6 py-4 rounded-lg text-white font-medium transition duration-200 ".concat(t?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transform hover:scale-[1.02]"),children:t?"设置中...":"设置多签权限"})]}),(0,s.jsx)("div",{className:"mt-8 pt-6 border-t border-gray-100",children:(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"作者 @xkbfdl • 有zjp,cx项目能出货的，可以考虑和我联系 • 欢迎中介技术和我对接"})})]})]})})})};function p(){return(0,s.jsx)("main",{className:"container mx-auto p-4",children:(0,s.jsx)(g,{})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[441,517,358],()=>r(5489)),_N_E=e.O()}]);