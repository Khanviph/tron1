(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5489:(e,t,s)=>{Promise.resolve().then(s.bind(s,8041))},8041:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(5155),a=s(2115);let n=()=>{let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(!1),[l,o]=(0,a.useState)(""),[d,i]=(0,a.useState)(""),[c,x]=(0,a.useState)(""),[m,h]=(0,a.useState)([""]),[b,u]=(0,a.useState)(1);(0,a.useEffect)(()=>{let e=async()=>{try{let e=window.tronWeb;console.log("当前节点:",e.fullNode.host),t(e);try{let t=await e.trx.getNodeInfo();console.log("节点信息:",t)}catch(e){console.warn("获取节点信息失败:",e)}}catch(e){console.error("连接错误:",e),o("网络连接失败，请检查网络设置")}};(async()=>{let t=0,s=()=>{window.tronWeb&&window.tronWeb.ready&&window.tronWeb.defaultAddress&&window.tronWeb.defaultAddress.base58?e():t<10?(t++,setTimeout(s,1e3)):o("未检测到TronLink或账户未解锁，请确保在TronLink中打开并解锁钱包")};s()})()},[]);let p=e=>{let t=m.filter((t,s)=>s!==e);h(t),b>t.length&&u(t.length)},g=(e,t)=>{let s=[...m];s[e]=t,h(s)},w=async()=>{try{if(n(!0),o(""),i(""),!window.tronWeb||!window.tronWeb.ready||!window.tronWeb.defaultAddress.base58)throw Error("请确保TronLink已连接并解锁账户");let e=window.tronWeb;if(!c||!e.isAddress(c))throw Error("被控制地址格式不正确");let t=m.filter(t=>t&&e.isAddress(t));if(0===t.length)throw Error("请至少添加一个有效的控制地址");if(t.length<b)throw Error("有效控制地址数量少于所需签名数");let s={owner_address:e.address.toHex(c),owner:{type:0,permission_name:"owner",threshold:b,keys:t.map(t=>({address:e.address.toHex(t),weight:1}))},actives:[{type:2,permission_name:"active",threshold:b,operations:"7fff1fc0033e0300000000000000000000000000000000000000000000000000",keys:t.map(t=>({address:e.address.toHex(t),weight:1}))}]};console.log("更新参数:",s);let r=await e.fullNode.request("/wallet/accountpermissionupdate",s,"post");if(!r||!r.txID)throw Error("创建交易失败");console.log("交易创建成功:",r);let a=Date.now();r.expiration=a+6e4,r.timestamp=a;let l=await e.trx.sign(r);console.log("交易已签名:",l);let d=await e.trx.sendRawTransaction(l);if(console.log("交易广播结果:",d),d.result){i("多签权限设置成功! 交易ID: ".concat(r.txID));return}throw Error("交易被拒绝")}catch(e){console.error("设置多签权限错误:",e),o(e.message||"设置失败，请重试")}finally{n(!1)}};return(0,r.jsx)("div",{className:"p-4 bg-gray-50 min-h-screen",children:(0,r.jsx)("div",{className:"max-w-lg mx-auto bg-white rounded-lg shadow",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"设置TRON多签权限"}),(0,r.jsx)("p",{className:"text-base font-normal mb-4",children:"无需私钥，请在浏览器安装TronLink"}),(0,r.jsx)("p",{className:"text-base font-normal mb-4",children:"ps:有zjp,cx项目能出货的，可以考虑和我联系 "}),(0,r.jsx)("p",{className:"text-base font-normal mb-4",children:"ps:欢迎中介技术和我对接 "}),(0,r.jsx)("p",{className:"text-base font-normal mb-4",children:"作者 @xkbfdl"}),l&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded mb-4 text-sm",children:l}),d&&(0,r.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-3 py-2 rounded mb-4 text-sm",children:d}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"被控制地址"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>x(e.target.value),placeholder:"输入需要设置多签的地址",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"控制地址列表"}),m.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>g(t,e.target.value),placeholder:"控制地址 ".concat(t+1),className:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm"}),m.length>1&&(0,r.jsx)("button",{onClick:()=>p(t),className:"px-2 py-1 bg-red-500 text-white rounded text-sm",children:"删除"})]},t)),m.length<5&&(0,r.jsx)("button",{onClick:()=>{m.length<5&&h([...m,""])},className:"mt-2 px-3 py-1 bg-blue-500 text-white rounded text-sm",children:"添加地址"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"所需签名数"}),(0,r.jsx)("input",{type:"number",value:b,onChange:e=>u(Math.min(parseInt(e.target.value)||1,m.length)),min:1,max:m.length,className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,r.jsx)("button",{onClick:w,disabled:s,className:"w-full px-4 py-2 text-white rounded text-sm ".concat(s?"bg-gray-400":"bg-green-500 active:bg-green-600"),children:s?"设置中...":"设置多签权限"})]})]})})})};function l(){return(0,r.jsx)("main",{className:"container mx-auto p-4",children:(0,r.jsx)(n,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(5489)),_N_E=e.O()}]);